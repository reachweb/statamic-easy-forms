<form
    method="{{ method }}"
    action="{{ action }}"
    x-data="formHandler('{{ event_name }}')"
    x-ref="form"
    x-on:submit.prevent="formSubmit"
    x-on:fields-changed="updateSubmitData($event.detail)"
    data-csrf-token="{{ csrf_token }}"
    aria-label="{{ title }}"
>
    {{# Honeypot field #}}
    {{ if honeypot }}
    <input type="text" name="{{ honeypot }}" class="hidden" tabindex="-1" autocomplete="off">
    {{ /if }}

    <div
        class="grid grid-cols-12 gap-6"
        x-data="formFields({{ fields | to_json | entities }}, '{{ honeypot }}', {{ hide_fields | to_json | entities ?? '[]' }}, {{ prepopulated_data | to_json | entities ?? '[]' }})"
        x-show="! successMessage"
        x-transition.opacity
    >
    {{ fields }}
    <div
        class="{{ if honeypot === handle || input_type === 'hidden' }}hidden{{ /if }}
        {{ if width === 50 }}col-span-12 md:col-span-6{{ elseif width === 33 }}col-span-12 md:col-span-4{{ elseif width === 25 }}col-span-12 md:col-span-3{{ else }}col-span-12{{ /if }}"
        x-show="shouldShowField('{{ handle }}')"
    >
        {{ unless type === 'toggle' || type === 'spacer' }}
        <div class="flex items-center mb-2">
            <label class="block font-semibold text-ef text-ef-label" for="{{ handle }}">
                {{ display }}
            </label>
            {{ if optional }}
            <span class="ml-2 text-ef text-ef-text-muted">
                ({{ "Optional" | trans }})
            </span>
            {{ /if }}
        </div>
        {{ /unless }}

        {{ if instructions && (instructions_position === 'above' || ! instructions_position) && type !== 'toggle' && type !== 'spacer' }}
        <div class="mb-3 text-ef text-ef-text">
            {{ instructions }}
        </div>
        {{ /if }}

        {{# Simple text input #}}
        {{ if type == 'text' && (input_type == 'text' || input_type == 'email' || (input_type == 'tel' && !improved_field) || (input_type == 'date' && !improved_field)) }}
            {{ partial:statamic-easy-forms::form/fieldtypes/text }}
        {{ /if }}

        {{# Date #}}
        {{ if input_type == 'date' && type == 'text' && improved_field }}
            {{ partial:statamic-easy-forms::form/fieldtypes/date }}
        {{ /if }}

        {{# Phone #}}
        {{ if input_type == 'tel' && type == 'text' && improved_field }}
            {{ partial:statamic-easy-forms::form/fieldtypes/telephone }}
        {{ /if }}

        {{# Time #}}
        {{ if input_type == 'time' && type == 'text' }}
            {{ partial:statamic-easy-forms::form/fieldtypes/time }}
        {{ /if }}

        {{# Integer #}}
        {{ if type == 'integer' }}
            {{ partial:statamic-easy-forms::form/fieldtypes/integer }}
        {{ /if }}

        {{# Radio #}}
        {{ if type == 'radio' && !improved_field }}
            {{ partial:statamic-easy-forms::form/fieldtypes/radio }}
        {{ /if }}

        {{# Radio Improved #}}
        {{ if type == 'radio' && improved_field }}
            {{ partial:statamic-easy-forms::form/fieldtypes/radio_improved }}
        {{ /if }}

        {{# Checkboxes #}}
        {{ if type == 'checkboxes' }}
            {{ partial:statamic-easy-forms::form/fieldtypes/checkboxes }}
        {{ /if }}

        {{# Select #}}
        {{ if type == 'select' && !improved_field }}
            {{ partial:statamic-easy-forms::form/fieldtypes/select }}
        {{ /if }}

        {{# Select Improved #}}
        {{ if type == 'select' && improved_field }}
            {{ partial:statamic-easy-forms::form/fieldtypes/select_improved }}
        {{ /if }}

        {{# Textarea #}}
        {{ if type == 'textarea' }}
            {{ partial:statamic-easy-forms::form/fieldtypes/textarea }}
        {{ /if }}

        {{# File Upload / Assets #}}
        {{ if type == 'assets' }}
            {{ partial:statamic-easy-forms::form/fieldtypes/file }}
        {{ /if }}

        {{# Dictionary #}}
        {{ if type == 'dictionary' && dictionary !== 'country_phone_codes' }}
            {{ partial:statamic-easy-forms::form/fieldtypes/dictionary }}
        {{ /if }}

        {{# Toggle #}}
        {{ if type == 'toggle' }}
            {{ partial:statamic-easy-forms::form/fieldtypes/toggle }}
        {{ /if }}

        {{# Spacer #}}
        {{ if type == 'spacer' }}
            {{ partial:statamic-easy-forms::form/fieldtypes/spacer }}
        {{ /if }}

        {{ if instructions && instructions_position === 'below' && type !== 'toggle' && type !== 'spacer' }}
        <div class="mt-3 text-ef text-ef-text">
            {{ instructions }}
        </div>
        {{ /if }}

        <div class="mt-1 text-ef-error" x-show="'{{ handle }}' in errors" x-text="errors['{{ handle }}']" x-transition role="alert" aria-live="polite"></div>
    </div>
    {{ /fields }}
    </div>

    <div class="w-full" x-cloak x-show="! successMessage">
        <div class="my-1 text-center text-ef-error" x-show="fatalError" x-cloak role="alert" aria-live="assertive">
            {{ "There is a technical problem with our form. Please contact us using email." | trans }}
        </div>
    </div>

    <div class="w-full pt-8 xl:pt-12">
        <button
            class="relative w-full px-6 py-3.5 text-ef-button-text bg-ef-button-bg hover:bg-ef-button-bg-hover focus:ring-4 focus:outline-none font-bold rounded-ef text-ef-lg xl:text-ef-xl focus:ring-ef-focus/20 text-center disabled:opacity-50 transition-all duration-300 cursor-pointer"
            x-bind:class="{ 'cursor-not-allowed opacity-50': disableSubmit }"
            type="submit"
            x-bind:disabled="disableSubmit"
            x-show="! successMessage"
            x-bind:aria-busy="disableSubmit"
        >
            <span>{{ "Submit" | trans }}</span>
        </button>
    </div>

    <div class="text-ef-xl text-center my-4 text-ef-text" x-show="successMessage" x-transition.opacity x-cloak role="status" aria-live="polite">
        {{ "Thank you for your message! We will get back to you shortly!" | trans }}
    </div>
</form>
