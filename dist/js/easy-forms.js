function l(o="formSubmitted",n=null){return{formHandle:o,recaptchaSiteKey:n,submitData:{},errors:{},fatalError:!1,disableSubmit:!1,successMessage:!1,hasReCaptcha:!!n,isSubmitting:!1,init(){this.recaptchaSiteKey&&this.loadReCaptcha()},updateSubmitData(e){this.submitData=e},async formSubmit(){if(!this.isSubmitting){this.isSubmitting=!0,this.$refs.form.dispatchEvent(new CustomEvent("form:submit",{bubbles:!0,detail:{submitData:this.submitData,formHandle:this.formHandle}}));try{this.clearErrors(),this.toggleSubmit();let e=null;if(this.recaptchaSiteKey)try{e=await this.getReCaptchaToken()}catch{this.fatalError=!0,this.$refs.form.dispatchEvent(new CustomEvent("form:error",{bubbles:!0,detail:{error:"ReCAPTCHA verification failed. Please refresh the page.",fatalError:!0,formHandle:this.formHandle}}));return}const s=this.buildFormData(e),r=await fetch(this.$refs.form.action,{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:s});if(!r.ok){await this.handleErrors(r);return}const t=await r.json();this.handleSuccess(t)}catch(e){this.fatalError=!0,this.$refs.form.dispatchEvent(new CustomEvent("form:error",{bubbles:!0,detail:{error:e.message,fatalError:!0,formHandle:this.formHandle}}))}finally{this.toggleSubmit(),this.isSubmitting=!1}}},buildFormData(e){const s=new FormData;return Object.entries(this.submitData).forEach(([r,t])=>{t instanceof FileList?Array.from(t).forEach(i=>s.append(`${r}[]`,i)):t instanceof File?s.append(r,t):Array.isArray(t)?t.forEach(i=>s.append(`${r}[]`,i)):t!=null&&s.append(r,t)}),s.append("_token",this.$refs.form.dataset.csrfToken),e&&s.append("g-recaptcha-response",e),s},toggleSubmit(){this.disableSubmit=!this.disableSubmit},handleSuccess(e){e.success&&(this.successMessage=!0,this.$refs.form.dispatchEvent(new CustomEvent("form:success",{bubbles:!0,detail:{data:e,submitData:this.submitData,formHandle:this.formHandle}})))},async handleErrors(e){try{if(e.status===500)this.fatalError=!0;else{const s=await e.json();this.errors=s?.error||s?.errors||{}}this.$refs.form.dispatchEvent(new CustomEvent("form:error",{bubbles:!0,detail:{errors:this.errors,status:e.status,fatalError:this.fatalError,formHandle:this.formHandle}})),this.$nextTick(()=>{this.scrollToFirstError()})}catch{this.fatalError=!0,this.$refs.form.dispatchEvent(new CustomEvent("form:error",{bubbles:!0,detail:{errors:{},fatalError:!0,formHandle:this.formHandle}}))}},scrollToFirstError(){if(Object.keys(this.errors).length===0)return;const e=Object.keys(this.errors)[0],s=this.$refs.form.querySelector(`label[for="${e}"]`),r=s?s.closest("div"):this.$refs.form.querySelector(`#${e}`);if(!r)return;const t=r.getBoundingClientRect();t.top>=0&&t.bottom<=window.innerHeight||r.scrollIntoView({behavior:"smooth",block:"center"})},clearErrors(){this.errors={},this.fatalError=!1},loadReCaptcha(){if(this.recaptchaSiteKey&&!document.querySelector('script[src*="recaptcha"]')){const e=document.createElement("script");e.src=`https://www.google.com/recaptcha/api.js?render=${this.recaptchaSiteKey}`,e.async=!0,e.defer=!0,document.head.appendChild(e)}},getReCaptchaToken(){return new Promise((e,s)=>{if(!this.recaptchaSiteKey){e(null);return}const r=setTimeout(()=>{s(new Error("ReCAPTCHA timeout"))},1e4);let t=0;const i=100,a=()=>{typeof grecaptcha<"u"&&grecaptcha.ready?grecaptcha.ready(()=>{grecaptcha.execute(this.recaptchaSiteKey,{action:"submit"}).then(c=>{clearTimeout(r),e(c)}).catch(c=>{clearTimeout(r),s(c)})}):t++<i?setTimeout(a,100):(clearTimeout(r),s(new Error("ReCAPTCHA failed to load")))};a()})}}}function h(o,n,e,s){return{submitFields:{},fields:[],fieldsMap:{},honeypot:"",init(){this.honeypot=n,this.fields=o.filter(t=>t.input_type!=="hidden").filter(t=>!e.includes(t.handle)),this.submitFields=this.initializeFields(o),this.fieldsMap=o.reduce((t,i)=>({...t,[i.handle]:i}),{}),s&&Object.keys(s).length>0&&this.loadPrepopulatedData(s);let r;this.$watch("submitFields",()=>{clearTimeout(r),r=setTimeout(()=>{this.$dispatch("fields-changed",this.submitFields)},100)},{deep:!0}),this.$nextTick(()=>{this.$dispatch("fields-changed",this.submitFields)})},shouldShowField(r){const t=this.fieldsMap[r];if(!t)return!1;try{return typeof window.Statamic>"u"||!window.Statamic?.$conditions?.showField?!0:window.Statamic.$conditions.showField(t,this.submitFields)}catch{return!0}},initializeFields(r){return r.reduce((t,i)=>{let a;return i.type==="assets"?a=null:i.type==="checkboxes"?a=i.default||[]:a=i.default||"",{...t,[i.handle]:a}},{})},loadPrepopulatedData(r){const t={...this.submitFields};Object.keys(r).forEach(i=>{t.hasOwnProperty(i)&&(t[i]=r[i])}),this.submitFields=t}}}window.formHandler=l;window.formFields=h;
