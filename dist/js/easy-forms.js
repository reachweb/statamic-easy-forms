function l(o="formSubmitted"){return{formHandle:o,submitData:{},errors:{},fatalError:!1,disableSubmit:!1,successMessage:!1,hasReCaptcha:!1,init(){},updateSubmitData(e){this.submitData=e},async formSubmit(){this.$refs.form.dispatchEvent(new CustomEvent("form:submit",{bubbles:!0,detail:{submitData:this.submitData,formHandle:this.formHandle}}));try{this.clearErrors(),this.toggleSubmit();const r=this.buildFormData(null),i=await fetch(this.$refs.form.action,{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:r});if(!i.ok){await this.handleErrors(i),this.toggleSubmit();return}const t=await i.json();this.handleSuccess(t)}catch(e){this.fatalError=!0,this.toggleSubmit(),this.$refs.form.dispatchEvent(new CustomEvent("form:error",{bubbles:!0,detail:{error:e.message,fatalError:!0,formHandle:this.formHandle}}))}},buildFormData(e){const r=new FormData;return Object.entries(this.submitData).forEach(([i,t])=>{t instanceof FileList?Array.from(t).forEach(s=>r.append(`${i}[]`,s)):t instanceof File?r.append(i,t):Array.isArray(t)?t.forEach(s=>r.append(`${i}[]`,s)):t!=null&&r.append(i,t)}),r.append("_token",this.$refs.form.dataset.csrfToken),e&&r.append("g-recaptcha-response",e),r},toggleSubmit(){this.disableSubmit=!this.disableSubmit},handleSuccess(e){e.success&&(this.successMessage=!0,this.$refs.form.dispatchEvent(new CustomEvent("form:success",{bubbles:!0,detail:{data:e,submitData:this.submitData,formHandle:this.formHandle}})))},async handleErrors(e){try{if(e.status===500)this.fatalError=!0;else{const r=await e.json();this.errors=r?.error||r?.errors||{}}this.$refs.form.dispatchEvent(new CustomEvent("form:error",{bubbles:!0,detail:{errors:this.errors,status:e.status,fatalError:this.fatalError,formHandle:this.formHandle}}))}catch{this.fatalError=!0,this.$refs.form.dispatchEvent(new CustomEvent("form:error",{bubbles:!0,detail:{errors:{},fatalError:!0,formHandle:this.formHandle}}))}},clearErrors(){this.errors={},this.fatalError=!1},loadReCaptcha(){},getReCaptchaToken(){return new Promise((e,r)=>{{e(null);return}})}}}function h(o,e,r,i){return{submitFields:{},fields:[],fieldsMap:{},honeypot:"",init(){this.honeypot=e,this.fields=o.filter(s=>s.input_type!=="hidden").filter(s=>!r.includes(s.handle)),this.submitFields=this.initializeFields(o),this.fieldsMap=o.reduce((s,a)=>({...s,[a.handle]:a}),{}),i&&Object.keys(i).length>0&&this.loadPrepopulatedData(i);let t;this.$watch("submitFields",()=>{clearTimeout(t),t=setTimeout(()=>{this.$dispatch("fields-changed",this.submitFields)},100)},{deep:!0}),this.$nextTick(()=>{this.$dispatch("fields-changed",this.submitFields)})},shouldShowField(t){const s=this.fieldsMap[t];return s?window.Statamic?.$conditions?.showField?Statamic.$conditions.showField(s,this.submitFields):!0:!1},initializeFields(t){return t.reduce((s,a)=>{let n;return a.type==="assets"?n=null:a.type==="checkboxes"?n=a.default||[]:n=a.default||"",{...s,[a.handle]:n}},{})},loadPrepopulatedData(t){const s={...this.submitFields};Object.keys(t).forEach(a=>{s.hasOwnProperty(a)&&(s[a]=t[a])}),this.submitFields=s}}}window.formHandler=l;window.formFields=h;
