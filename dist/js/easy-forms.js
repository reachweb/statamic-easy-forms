function c(a="formSubmitted",o=null){return{formHandle:a,recaptchaSiteKey:o,submitData:{},errors:{},fatalError:!1,disableSubmit:!1,successMessage:!1,hasReCaptcha:!!o,init(){this.recaptchaSiteKey&&this.loadReCaptcha()},updateSubmitData(t){this.submitData=t},async formSubmit(){this.$refs.form.dispatchEvent(new CustomEvent("form:submit",{bubbles:!0,detail:{submitData:this.submitData,formHandle:this.formHandle}}));try{this.clearErrors(),this.toggleSubmit();let t=null;if(this.recaptchaSiteKey)try{t=await this.getReCaptchaToken()}catch{this.fatalError=!0,this.toggleSubmit(),this.$refs.form.dispatchEvent(new CustomEvent("form:error",{bubbles:!0,detail:{error:"ReCAPTCHA verification failed. Please refresh the page.",fatalError:!0,formHandle:this.formHandle}}));return}const r=this.buildFormData(t),s=await fetch(this.$refs.form.action,{method:"POST",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:r});if(!s.ok){await this.handleErrors(s),this.toggleSubmit();return}const e=await s.json();this.handleSuccess(e)}catch(t){this.fatalError=!0,this.toggleSubmit(),this.$refs.form.dispatchEvent(new CustomEvent("form:error",{bubbles:!0,detail:{error:t.message,fatalError:!0,formHandle:this.formHandle}}))}},buildFormData(t){const r=new FormData;return Object.entries(this.submitData).forEach(([s,e])=>{e instanceof FileList?Array.from(e).forEach(i=>r.append(`${s}[]`,i)):e instanceof File?r.append(s,e):Array.isArray(e)?e.forEach(i=>r.append(`${s}[]`,i)):e!=null&&r.append(s,e)}),r.append("_token",this.$refs.form.dataset.csrfToken),t&&r.append("g-recaptcha-response",t),r},toggleSubmit(){this.disableSubmit=!this.disableSubmit},handleSuccess(t){t.success&&(this.successMessage=!0,this.$refs.form.dispatchEvent(new CustomEvent("form:success",{bubbles:!0,detail:{data:t,submitData:this.submitData,formHandle:this.formHandle}})))},async handleErrors(t){try{if(t.status===500)this.fatalError=!0;else{const r=await t.json();this.errors=r?.error||r?.errors||{}}this.$refs.form.dispatchEvent(new CustomEvent("form:error",{bubbles:!0,detail:{errors:this.errors,status:t.status,fatalError:this.fatalError,formHandle:this.formHandle}})),this.$nextTick(()=>{this.scrollToFirstError()})}catch{this.fatalError=!0,this.$refs.form.dispatchEvent(new CustomEvent("form:error",{bubbles:!0,detail:{errors:{},fatalError:!0,formHandle:this.formHandle}}))}},scrollToFirstError(){if(Object.keys(this.errors).length===0)return;const t=Object.keys(this.errors)[0],r=this.$refs.form.querySelector(`label[for="${t}"]`),s=r?r.closest("div"):this.$refs.form.querySelector(`#${t}`);if(!s)return;const e=s.getBoundingClientRect();e.top>=0&&e.bottom<=window.innerHeight||s.scrollIntoView({behavior:"smooth",block:"center"})},clearErrors(){this.errors={},this.fatalError=!1},loadReCaptcha(){if(this.recaptchaSiteKey&&!document.querySelector('script[src*="recaptcha"]')){const t=document.createElement("script");t.src=`https://www.google.com/recaptcha/api.js?render=${this.recaptchaSiteKey}`,t.async=!0,t.defer=!0,document.head.appendChild(t)}},getReCaptchaToken(){return new Promise((t,r)=>{if(!this.recaptchaSiteKey){t(null);return}if(typeof grecaptcha>"u"){r(new Error("ReCaptcha not loaded"));return}grecaptcha.ready(()=>{grecaptcha.execute(this.recaptchaSiteKey,{action:"submit"}).then(t).catch(r)})})}}}function h(a,o,t,r){return{submitFields:{},fields:[],fieldsMap:{},honeypot:"",init(){this.honeypot=o,this.fields=a.filter(e=>e.input_type!=="hidden").filter(e=>!t.includes(e.handle)),this.submitFields=this.initializeFields(a),this.fieldsMap=a.reduce((e,i)=>({...e,[i.handle]:i}),{}),r&&Object.keys(r).length>0&&this.loadPrepopulatedData(r);let s;this.$watch("submitFields",()=>{clearTimeout(s),s=setTimeout(()=>{this.$dispatch("fields-changed",this.submitFields)},100)},{deep:!0}),this.$nextTick(()=>{this.$dispatch("fields-changed",this.submitFields)})},shouldShowField(s){const e=this.fieldsMap[s];if(!e)return!1;try{return typeof window.Statamic>"u"||!window.Statamic?.$conditions?.showField?!0:window.Statamic.$conditions.showField(e,this.submitFields)}catch{return!0}},initializeFields(s){return s.reduce((e,i)=>{let n;return i.type==="assets"?n=null:i.type==="checkboxes"?n=i.default||[]:n=i.default||"",{...e,[i.handle]:n}},{})},loadPrepopulatedData(s){const e={...this.submitFields};Object.keys(s).forEach(i=>{e.hasOwnProperty(i)&&(e[i]=s[i])}),this.submitFields=e}}}window.formHandler=c;window.formFields=h;
